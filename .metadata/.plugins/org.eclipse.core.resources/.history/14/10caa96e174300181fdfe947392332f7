package de.fh_kiel.cimtt.robotik;




import java.io.IOException;
import java.util.Properties;

import com.kuka.common.ThreadUtil;
import com.kuka.generated.ioAccess.*;
import com.kuka.roboticsAPI.conditionModel.ForceCondition;
import com.kuka.roboticsAPI.controllerModel.Controller;
import com.kuka.roboticsAPI.deviceModel.LBR;
import com.kuka.roboticsAPI.geometricModel.AbstractFrame;
import com.kuka.roboticsAPI.geometricModel.Tool;
import com.kuka.roboticsAPI.geometricModel.math.CoordinateAxis;
import com.kuka.roboticsAPI.geometricModel.math.Vector;
import com.kuka.roboticsAPI.sensorModel.ForceSensorData;

public class EGripper extends Gripper{
	FlexFellowIOGroup digitalOut;
	Tool toolEgripper;
	LBR robotEgripper;
	/**
	 * 
	 * @param controller Verwendeter Controller
	 * @param robot	Verwendetet Roboter
	 * @param tool Verwendeter Greifer
	 */
	public EGripper(Controller controller, LBR robot, Tool tool){
		super(controller, robot, tool);

	    	

	    // Hier aufbauen der GUI mit den Einstellungen 
	    // in der Property-Datei
		
		digitalOut = new FlexFellowIOGroup(controller);
		toolEgripper = tool;
		robotEgripper = robot;
	}
	
	/**
	 * @return true wenn Greifer vollständig geöffnet
	 * @return false wenn nicht
	 */
	public boolean close(){
		digitalOut.setCloseGripper(true);
		digitalOut.setOpenGripper(false);
		for(int i = 0; i < 10; i++){
			if(digitalOut.getGripperIsClose()){
				return true;
			}
			ThreadUtil.milliSleep(100);
		}
		return false;
	}
	
	/**
	 * @return true wenn Greifer vollständig geschlossen
	 * @return false wenn nicht
	 */
	public boolean open(){
		digitalOut.setCloseGripper(false);
		digitalOut.setOpenGripper(true);
		for(int i = 0; i < 10; i++){
			if(digitalOut.getGripperIsOpen()){
				digitalOut.setOpenGripper(false);
				return true;
			}
			ThreadUtil.milliSleep(100);
		}
		digitalOut.setOpenGripper(false);
		return false;
	}
	

	/*
	 * Task: Fill glass with one liquid*/
	public boolean fillGlass(AbstractFrame ingredient) {
		//Move to Bottle
		this.moveNear(ingredient);
		//TODO: Configure Sensibility and check distance 
		//Move up
		this.moveZ(10); //Measure Distance
		
		//TODO: Wait for fluid to fill --> Measure weight of filling and go on
		ForceCondition normalForce = ForceCondition.createNormalForceCondition(this.toolEgripper.getDefaultMotionFrame(),CoordinateAxis.Z , 10.0);
		ForceSensorData data = robot.getExternalForceTorque(tool.getDefaultMotionFrame(), tool.getDefaultMotionFrame() );
		Vector force = data.getForce(); //Get actual current forces (angle, weight, etc)
		
		//TODO: Move down
		this.moveZ(-10); //Measure Distance
		
		
		return false;
	}
	
	
}
